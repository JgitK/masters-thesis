---
title: "CES_analysisv2"
author: "Jackson"
date: "2023-07-14"
output: html_document
---

### Reset code...

```{r}
remove(list = ls())
```

### Load in Libraries

```{r,message=FALSE, warning=FALSE}
library(tidyverse)
#library(dplyr)
library(stargazer)
library(margins)
#library(car)
library(corrplot)
library(mfx)
#library(visdat)
#library(psych)
#library(lavaan)
#library(janitor)
```

### Load in data

Option to load in from a downloaded CSV, or download from webpage via URL


```{r}
data <- read_csv("/Users/jackson/Desktop/Thesis/Data/CES20_Common_OUTPUT_vv.csv")
#data <- read_csv("https://dataverse.harvard.edu/api/access/datafile/4949558") ### run if csv not downloaded
```

### Transform data 

Relevant variables subsetted from original dataset, and recoded\ to mirror variable specification from Ansolabehere and Hersh 2012.

```{r}
data_2 <- data %>% 
  dplyr::select(
         caseid, 
         CL_2020gvm, #did you actually vote (validated)? - yes if 1-4, no if 5
         CC20_401, #did you vote? - yes if 5, no otherwise (post)
         CC20_363, #vote intention - 1 = yes definitely, 2 = probably, 3 = I already voted, 4 = I plan to vote before Nov 3rd, 5 = no, 6 = undecided
         CC20_300_1, #did you use social media in the last 24h?
         CC20_300d_1, #posted story link or video about politics?
         CC20_300d_2, #posted comment about politics?
         CC20_300d_3, #read a story or watched video about politics?
         CC20_300d_4, #followed a political event?
         CC20_300d_5, #forwarded a story video photo or link about politics to friend?
         CC20_300d_6, #none of the above
         birthyr,
         gender,
         educ,
         race,
         #"CC20_303", #Household income (increase form last yr)
         marstat, #marital status
        # presvote16post, #presidential vote in 2016 election
        # ownhome, #home owner or not
        #immstat, #immigration status
         faminc_new,#family annual income over past yr
         pew_churatd, #church attendance
         newsint, #political interest
         ideo5, #ideology 1 - very liberal, 2 - liberal, 3 - moderate, 4 - conservative, 5 - very conservative, 6 - don't know
        # employ,
        # inputstate,
         #child18, #parent/guardian of child under 18
         pid7, # 7 point party ID
         commonweight,
        commonpostweight
         ) %>% 

  mutate(
    
    #Did you plan to vote? Did you vote?
    intend_to_vote = ifelse(CC20_363 %in% c(1,4), 1, 0),
    did_you_vote = ifelse(CC20_401 == 5, 1, 0),
    validated_vote = ifelse(CL_2020gvm == 5, 0, 1),
    over_reported_vote = ifelse(intend_to_vote == 1 
                                #& validated_vote == 0
                                , 1, 0
                                ),
    
    over_reported_vote2 = ifelse(did_you_vote == 1, 1, 0),
    
    #Social media usage
    posted_story_link = ifelse(CC20_300d_1 == 2, 0, 1),
    posted_comment = ifelse(CC20_300d_2 == 2, 0, 1),
    saw_story = ifelse(CC20_300d_3 == 2, 0, 1),
    followed_political_event = ifelse(CC20_300d_4 == 2, 0, 1),
    forwarded_story = ifelse(CC20_300d_5 == 2, 0, 1),
    
    #Additive social media usage (SMU)
    social_media_engagement = posted_story_link + posted_comment + saw_story + followed_political_event + forwarded_story,
    
    is_politically_engaged = ifelse(social_media_engagement >= 1, 1, 0),
    
    # Public engagement = posted comment or posted story link/video (followed political event?)
    # Private engagement = saw story or forwarded a story
    
    ### OLD ###
    # passive_user = ifelse(posted_comment == 0 & posted_story_link == 0 & forwarded_story == 0 & 
    #                         (saw_story == 1 | followed_political_event == 1), 1, 0),
    # 
    # active_user = ifelse(posted_comment == 1 | posted_story_link == 1 | forwarded_story == 1
    #                      , 1, 0),
    ### OLD ###
    
    ### NEW ###
    active_user = ifelse(posted_comment == 1 | posted_story_link == 1 | followed_political_event == 1, 1, 0),

passive_user = ifelse((posted_comment == 0 & posted_story_link == 0 & forwarded_story == 0) &
                      (saw_story == 1 | followed_political_event == 1), 1, 0),



    ### NEW ###
    
    active_passive = as.factor(case_when( # active when 1, passive when 0
      passive_user == 1 ~ 0,
      active_user == 1 ~ 1
    )),
    
    social_media_categories = case_when(
      saw_story == 1 ~ 1, # no social media usage (least active)
      forwarded_story == 1 ~ 2, # passive user
      followed_political_event == 1 ~ 3, # active 1
      posted_comment == 1 ~ 4, # active 2
      posted_story_link == 1 ~ 5
      #, # active 3 (most active)
      #saw_story == 0 & forwarded_story == 0 & followed_political_event == 0 & posted_comment == 0 & posted_story_link == 0 ~ 0
    ),
    
    #Education
    education = case_when(
      educ == 1 ~ 0,
      educ == 2 ~ 1,
      educ %in% c(3, 4) ~ 2,
      educ == 5 ~ 3,
      educ == 6 ~ 4
    ),
    
    #Household Income
    income = case_when(
      faminc_new %in% c(1, 2, 3) ~ 1,
      faminc_new %in% c(4, 5) ~ 2,
      faminc_new %in% c(6, 7, 8, 9) ~ 3,
      faminc_new %in% c(10, 11, 12, 13, 14, 16) ~ 4,
      faminc_new == 97 ~ 5
    ),
    
    #Church attendance
    church_attendance = case_when(
      pew_churatd == 6 ~ 0,
      pew_churatd %in% c(4, 5) ~ 1,
      pew_churatd == 3 ~ 2,
      pew_churatd %in% c(1, 2) ~ 3,
      pew_churatd == 7 ~ 4),

    #Age
    age = 2020 - birthyr,
    age_cat = cut(age,
                  
                  breaks = c(17, 24, 34, 44, 54, Inf),
                  labels = c("1", "2", "3", "4", "5"), #18-29, 30-44, 45-64, 65 and over
                  right = TRUE, include.lowest = TRUE),
    
      #Ideological strength
    ideological_strength = case_when(
      ideo5 %in% c(3, 6) ~ 0,
      ideo5 %in% c(2, 4) ~ 1,
      ideo5 %in% c(1, 5) ~ 2
      ),

    #Political interest
    political_interest = case_when(
      newsint %in% c(7, 4) ~ 0,
      newsint == 3 ~ 1,
      newsint == 2 ~ 2,
      newsint == 1 ~ 3
    ),
    
    #Partisan strength
    partisan_strength = case_when(
      pid7 %in% c(4, 8) ~ 0,
      pid7 %in% c(3, 5) ~ 1,
      pid7 %in% c(2, 6) ~ 2,
      pid7 %in% c(1, 7) ~ 3
      ),
   
   # ideo5 <- as.factor(ideo5),
    

#Female
    female = ifelse(gender == 2, 1, 0),

 #Race
    White = ifelse(race == 1, 1, 0),
    Black = ifelse(race == 2, 1, 0),
    other_non_White = ifelse(!race %in% c(1, 2), 1, 0),
    
    #Married
    married = ifelse(marstat == 1, 1, 0),
      
    )
```

```{r}
View(nonvoters)
vis_miss(data_2, warn_large_data = F)
table(data_2$CC20_401)
table(data_2$CL_2020gvm)
table(data_2$church_attendance)
table(data$pew_churatd)
#prop.table(
  table(nonvoters$over_reported_vote)
 # )

overreported <- data_2 %>% 
  filter(validated_vote == 0 & intend_to_vote == 1 & !is.na(CL_2020gvm))
overreported


```


### Delete rows with any NA values

```{r}
table(nonvoters$did_you_vote)
nonvoters <- data_2 %>% 
  filter(CL_2020gvm == 5 
         & !is.na(CC20_300d_6) & !is.na(CC20_363) & !is.na(CC20_401)
         & !is.na(CC20_300d_6)
         ) 
```

```{r}
nonvoters <- nonvoters %>% 
  mutate(user_engagement_score = saw_story + 2*followed_political_event + 3*forwarded_story + 3*posted_comment  + 4*posted_story_link)

p50 <- quantile(nonvoters$user_engagement_score, 0.5, na.rm=T)
p25 <- quantile(nonvoters$user_engagement_score, 0.25, na.rm=T)
p75 <- quantile(nonvoters$user_engagement_score, 0.75, na.rm=T)

# Categorize users into low, medium, and high activity groups
nonvoters <- nonvoters %>% 
  mutate(user_engagement_category = case_when(
    user_engagement_score <= p25 ~ 1,
    user_engagement_score > p25 & user_engagement_score <= p75 ~ 2,
    user_engagement_score > p75 ~ 3
  ))


nonvoters$user_engagement_category = ifelse(nonvoters$user_engagement_score >= p50, 0, 1) # 0 = Active and 1 = Passive

table(nonvoters$user_engagement_category)
```


Confirmatory Factor Analysis

```{r}
cfa <- 'latent_social_media_engagement =~ posted_story_link + posted_comment + saw_story + followed_political_event + forwarded_story'
fit<- cfa(cfa, data=nonvoters)
summary(fit, fit.measures=T)
```

```{r}
categorical_vars <- list("is_politically_engaged",
                         "social_media_engagement",
                         "passive_user",
                         "user_engagement_category",
                         "ideo5",
                         "education",
                         "income",
                         "Black",
                         "other_non_White",
                         "married",
                         "church_attendance",
                         "age_cat",
                         "ideological_strength",
                         "female",
                         "political_interest")

get_stats <- function(data, var) {
  data %>%
    count(.data[[var]]) %>%
    mutate(
      proportion = n / sum(n) * 100,
      cumulative_freq = cumsum(proportion)
    )
}

stats_list <- lapply(categorical_vars, function(var) get_stats(nonvoters, var))

stats_list

```


```{r}
nonvoters %>% 
  group_by(social_media_categories) %>% 
  summarize(count = n(),
            prop = sum(social_media_categories) / count)

nonvoters_engaged %>% 
  group_by(education) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters_disengaged %>% 
  group_by(education) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(education) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(income) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(church_attendance) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters_engaged %>% 
  group_by(age_cat) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters_disengaged %>% 
  group_by(age_cat) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(Black) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(other_non_White) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(married) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(female) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(ideological_strength) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

nonvoters %>% 
  group_by(political_interest) %>% 
  summarize(count = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / count)

prop.table(table(nonvoters$over_reported_vote))

nonvoters %>% 
  group_by(ideo5) %>% 
  summarize(count = n())

nonvoters %>% 
  group_by(social_media_engagement) %>% 
  summarize(total = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / total)

nonvoters %>% 
  group_by(ideo5) %>% 
  summarize(total = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / total)

nonvoters %>% 
  group_by(user_engagement_category) %>% 
  summarize(total = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / total)

nonvoters %>% 
  group_by(is_politically_engaged) %>% 
  summarize(total = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / total)

stargazer(is_politically_engaged_table, type="text")

nonvoters %>% 
  group_by(social_media_categories) %>% 
  summarize(total = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / total)

nonvoters %>% 
  group_by(passive_user) %>% 
  summarize(total = n(),
            overreport = sum(over_reported_vote),
            prop = overreport / total)

nonvoters_engaged %>% 
  group_by(social_media_categories) %>% 
  summarize(count=n()) %>% 
  ggplot(aes(x = social_media_categories, y = count)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(x = "Social Media Categories", y = "Count", title = "Count of Social Media Categories") +
  theme_minimal()
```

```{r}

```



```{r}
nonvoters %>% 
  group_by(social_media_engagement) %>% 
  summarize(count = n()) %>% 
  mutate(prop = count/sum(count)*100) %>% 
  ggplot(aes(x=social_media_engagement, y=prop))

(prop.table(table(nonvoters$social_media_engagement))*100)

str(nonvoters)
```


### Proportion of over-reporters by social media engagement table

```{r}
nonvoters %>% 
  group_by(active_passive) %>% 
  summarize(over_report = mean(over_reported_vote, na.rm=TRUE))

nonvoters %>% 
  count(active_passive)
```
```{r}
active_passive_proportions <- nonvoters %>% 
  group_by(active_passive, over_reported_vote) %>% 
  summarize(count = n(), .groups = "drop") %>% 
  mutate(over_reported_vote = ifelse(over_reported_vote == 1, "Yes", "No")) %>% 
  mutate(over_reported_vote = factor(over_reported_vote, levels = c("No", "Yes"))) %>%
  group_by(active_passive) %>% 
  mutate(proportion = count/sum(count)) %>% 
  ungroup() %>% 
  
  ggplot(aes(x = active_passive, y = proportion, fill = over_reported_vote)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_grey(name = "Over-reported vote") +
  xlab("Passive / Active Users") +
  ylab("Proportion") +
  theme_minimal() +
  ggtitle("Proportion ov Over-report by Active / passive users")
active_passive_proportions
```

```{r}
is_politically_engaged_proportions <- nonvoters %>% 
  group_by(is_politically_engaged, over_reported_vote) %>% 
  summarize(count = n(), .groups = "drop") %>% 
  mutate(over_reported_vote = ifelse(over_reported_vote == 1, "Yes", "No")) %>% 
  mutate(over_reported_vote = factor(over_reported_vote, levels = c("No", "Yes"))) %>%
  group_by(is_politically_engaged) %>% 
  mutate(proportion = count/sum(count)) %>% 
  ungroup() %>% 
  
  ggplot(aes(x = is_politically_engaged, y = proportion, fill = over_reported_vote)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_grey(name = "Over-reported vote") +
  xlab("is politically engaged?") +
  ylab("Proportion") +
  theme_minimal() +
  ggtitle("Proportion of Over-report by Political Engagement on Social Media")
is_politically_engaged_proportions
```

```{r}
user_engagement_proportions <- nonvoters %>% 
  group_by(user_engagement_category, over_reported_vote) %>% 
  summarize(count = n(), .groups = "drop") %>% 
  mutate(over_reported_vote = ifelse(over_reported_vote == 1, "Yes", "No")) %>% 
  mutate(over_reported_vote = factor(over_reported_vote, levels = c("No", "Yes"))) %>%
  group_by(user_engagement_category) %>% 
  mutate(proportion = count/sum(count)) %>% 
  ungroup() %>% 
  
  ggplot(aes(x = user_engagement_category, y = proportion, fill = over_reported_vote)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_grey(name = "Over-reported vote") +
  xlab("is politically engaged?") +
  ylab("Proportion") +
  theme_minimal() +
  ggtitle("Proportion of Over-report by Political Engagement on Social Media")
user_engagement_proportions
```


and plot these proportions...

```{r}
sme_proportions <- nonvoters %>% 
  group_by(social_media_engagement, over_reported_vote) %>% 
  summarize(count = n(), .groups = "drop") %>%
  mutate(over_reported_vote = ifelse(over_reported_vote == 1, "Yes", "No")) %>% 
  mutate(over_reported_vote = factor(over_reported_vote, levels = c("No", "Yes"))) %>%
  group_by(social_media_engagement) %>% 
  mutate(proportion = count / sum(count)) %>% 
  ungroup() %>% 
  
  ggplot(aes(x = social_media_engagement, y = proportion, fill = over_reported_vote)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_grey(name = "Over-Reported Vote") +
  xlab("Social Media Engagement") +
  ylab("Proportion") +
  theme_minimal() +
  ggtitle("Proportion of Over-report by Social Media Engagement")

sme_proportions
```

Doesn't seem to be much of a difference in over-reporting between users across engagement categories

```{r}
ideo_proportions <- nonvoters %>% 
  group_by(ideo5, over_reported_vote) %>% 
  summarize(count = n(), .groups = "drop") %>%
  mutate(over_reported_vote = ifelse(over_reported_vote == 1, "Yes", "No")) %>% 
  mutate(over_reported_vote = factor(over_reported_vote, levels = c("No", "Yes"))) %>%
  group_by(ideo5) %>% 
  mutate(proportion = count / sum(count)) %>% 
  ungroup() %>% 
  
  ggplot(aes(x = ideo5, y = proportion, fill = over_reported_vote)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_grey(name = "Over-Reported Vote") +
  xlab("Ideology") +
  ylab("Proportion") +
  theme_minimal() +
  ggtitle("Proportion of Over-report by Ideology")

ideo_proportions
```


```{r}
over_report_ideo <- nonvoters %>%
  
  mutate(over_reported_vote = factor(over_reported_vote, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  
  mutate(ideo_label = case_when(
    ideo5 == 1 ~ "Very Liberal",
    ideo5 == 2 ~ "Liberal",
    ideo5 == 3 ~ "Moderate",
    ideo5 == 4 ~ "Conservative",
    ideo5 == 5 ~ "Very Conservative",
    ideo5 == 6 ~ "Don't know"
  ))%>% 
  mutate(ideo_label = factor(ideo_label, levels = c("Very Liberal", "Liberal", "Moderate", "Conservative", "Very Conservative", "Don't know"))) %>%
  
  ggplot(aes(x = ideo_label, fill = over_reported_vote)) +
  geom_bar(position = "stack") +
  labs(x = "Ideology", y = "Count", fill = "Over Reported Vote") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Proportion of over-reports by total counts within ideology groups")
over_report_ideo

over_report_engaged <- nonvoters %>% 
  mutate(over_reported_vote = factor(over_reported_vote, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(engaged_label = case_when(
    is_politically_engaged == 1 ~ "Yes",
    is_politically_engaged == 0 ~ "No"
  )) %>% 
  mutate(engaged_lable = factor(engaged_label, levels = c("No", "Yes"))) %>%
  
  ggplot(aes(engaged_label, fill=over_reported_vote)) +
  geom_bar(position = "stack") +
  labs(x="is engaged?", y="Count", fill="Over reported vote") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
over_report_engaged

# Higher proportions of conservatives and very conservatives over-reported in the data, compared to
# very liberals, liberals, and moderates, but conservative groups also have less total over reporters
```

Correlation matrices

```{r}
matrix_independent_vars <- nonvoters %>% 
  select(social_media_engagement, 
         ideo5,
                 education,
                 age,
                 income,
                 White,
                 church_attendance,
                 ideological_strength,
                 political_interest,
                 partisan_strength,
                 married
                 )


matrix <- cor(na.omit(matrix_independent_vars), use = "complete.obs")
matrix
corrplot(matrix, method = "color", order = "hclust")

matrix_social_media <- nonvoters %>% 
  select(posted_story_link,
         posted_comment,
         saw_story,
         followed_political_event,
         forwarded_story)

matrix_2 <- cor(na.omit(matrix_social_media), use = "complete.obs")
matrix_2
corrplot(matrix_2, method="color", order="hclust")

### Positive correlations - Education and Income, Partisan and Ideological strength, Political interest and SME, Married and Income
### Negative correlations - Church attendance and Partisan strength, Education and age


```

### Modelling

```{r}
#Convert variables to factors
nonvoters <- nonvoters %>%
  mutate_at(vars(over_reported_vote,
                 active_user,
                 passive_user,
                 posted_story_link,
                 posted_comment,
                 saw_story,
                 followed_political_event,
                 forwarded_story,
                 active_passive,
                 age_cat,
                 White,
                 Black,
                 other_non_White,
                 female,
                 married,
                 #inputstate
                 ), as.factor)
str(nonvoters)

nonvoters_fac <- nonvoters %>% 
  mutate_at(vars(over_reported_vote,
                 is_politically_engaged,
                 social_media_engagement,
                 user_engagement_category,
                 active_user,
                 passive_user,
                 posted_story_link,
                 posted_comment,
                 saw_story,
                 followed_political_event,
                 forwarded_story,
                 active_passive,
                 education,
                 income,
                 church_attendance,
                 ideological_strength,
                 political_interest,
                 age_cat,
                 White,
                 Black,
                 other_non_White,
                 female,
                 married), as.factor)
```


```{r}

nonvoters_engaged <- nonvoters %>% 
  filter(user_engagement_score != 0)

nonvoters_disengaged <- nonvoters %>% 
  filter(user_engagement_score == 0)

nonvoters_cts <- nonvoters %>% 
  filter(
    #user_engagement_score != 0,
    ideo5 != 6, 
         faminc_new != 17, 
         church_attendance != 7)

nonvoters_cts_engaged <- nonvoters %>% 
  filter(
    user_engagement_score != 0,
    ideo5 != 6, 
         faminc_new != 17, 
         church_attendance != 7)

```


Hypothesis 1

```{r}

### Politically engaged on social media over past 24 hours
  

model_1 <- glm(over_reported_vote ~ as.factor(is_politically_engaged) #binary
                        +
                          as.factor(education) + # categories
                 as.factor(income) +#categories
                 Black +#binary
                 other_non_White + #binary
                 married + #binary
                 as.factor(church_attendance) +
                 as.factor(age_cat) +#categories
                 as.factor(ideological_strength) + #categories
                 female + #binary
                 as.factor(political_interest) 
                 ,
                 data = nonvoters, family = binomial
              # , weights=commonweight
               )

summary(margins(model_1))
model_1a <- glm(over_reported_vote ~ as.factor(is_politically_engaged) 
                        
                 ,
                 data = nonvoters, family = binomial
               # , weights=commonweight
                )

model_1_cts<- glm(over_reported_vote ~ as.factor(is_politically_engaged) 
                        +
                          education +
                 faminc_new +
                 Black +
                 other_non_White +
                 married +
                 church_attendance +
                 age_cat +
                 ideological_strength +
                 female +
                 political_interest 
                # partisan_strength
                 ,
                 data = nonvoters_cts, family = binomial)

str(nonvoters_cts)

str(nonvoters)
table(nonvoters$is_politically_engaged)

model_1a_u <- glm(over_reported_vote ~ as.factor(is_politically_engaged) 
                        
                 ,
                 data = nonvoters, family = binomial)

### when unweighted, results are significant, but when weighted, the results are insignificant.


stargazer(model_1, model_1a, model_1_cts, type="text")
stargazer(model_1_cts, type="text")

# avg_marginal_effects_is_engaged <- margins(model_is_engaged)
# avg_marginal_effects_5a_u <- margins(model_5a_u)
# summary(avg_marginal_effects_is_engaged, type="text") ### <--- avg marginal effect: -0.0239




```


```{r}
model_2 <- glm(over_reported_vote ~ as.factor(social_media_engagement) + # <---------
                 as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(church_attendance) +
                 as.factor(age_cat) +
                 as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest) 
               ,  
               data = nonvoters_engaged, family = binomial
               #, weights = commonweight
               ) 
model_2_mfx <- logitmfx(over_reported_vote ~ as.factor(social_media_engagement) + # <---------
                 as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(church_attendance) +
                 as.factor(age_cat) +
                 as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest) 
               ,  
               data = nonvoters_engaged
               #, weights = commonweight
               ) 
model_2_mfx
summary(margins(model_2))

model_2a <- glm(over_reported_vote ~ as.factor(social_media_engagement)  # <---------
                
               ,  
               data = nonvoters_engaged, family = binomial
               #, weights = commonweight
               ) 

model_2_cts <- glm(over_reported_vote ~ social_media_engagement + # <---------
                 education +
                 faminc_new +
                 Black +
                 other_non_White +
                 married +
                 church_attendance +
                 age_cat +
                 ideological_strength +
                 female +
                 political_interest 
                # partisan_strength 
               ,  
               data = nonvoters_cts_engaged, family = binomial
               
               ) 

stargazer(model_2, model_2a, model_2_cts, type="text")

```

Hypothesis 1 Unweighted

```{r}



model_2_cts_ols <- lm(intend_to_vote ~ social_media_engagement + # <---------
                 education +
                 income +
                 Black +
                 other_non_White +
                 married +
                   church_attendance +
                 age_cat +
                 ideological_strength +
                 female +
                 political_interest 
                # partisan_strength 
               ,  
               data = nonvoters_cts_engaged
               
               ) 

model_2a_cts_ols <- lm(intend_to_vote ~ social_media_engagement  # <---------
                
               ,  
               data = nonvoters_cts_engaged
               
               ) 

stargazer(model_2_u, model_2a_u, type="text")

stargazer(model_2_cts_ols, model_2a_cts_ols, type="text")


```


```{r}
model_3 <- glm(over_reported_vote ~ as.factor(saw_story) + as.factor(followed_political_event) + as.factor(posted_story_link) + as.factor(posted_comment) + as.factor(forwarded_story) +
                 as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(church_attendance) +
                 as.factor(age_cat) +
                 as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest) 
               ,  
               data = nonvoters, family = binomial
             ) 

model_3a <- glm(over_reported_vote ~ as.factor(saw_story) + as.factor(followed_political_event) + as.factor(posted_story_link) + as.factor(posted_comment) + as.factor(forwarded_story)
               ,  
               data = nonvoters, family = binomial
             ) 

model_3_cts <- glm(over_reported_vote ~ 
                   as.factor(saw_story) + as.factor(followed_political_event) + 
                   as.factor(posted_story_link) + as.factor(posted_comment) + as.factor(forwarded_story) +
                 education +
                 faminc_new +
                 Black +
                 other_non_White +
                 married +
                 church_attendance +
                 age_cat +
                 ideological_strength +
                 female +
                 political_interest,
               data = nonvoters_cts, family = binomial
             ) 

model_posted <- glm(over_reported_vote ~ 
                    
                   as.factor(posted_story_link) * as.factor(ideo5) +
                 education +
                 faminc_new +
                 Black +
                 other_non_White +
                 married +
                 church_attendance +
                 age_cat +
                 ideological_strength +
                 female +
                 political_interest,
               data = nonvoters, family = binomial)

stargazer(model_posted, type="text")

stargazer(model_3, model_3a, model_3_cts, type="text")

```


```{r}
model_4 <- glm(over_reported_vote ~ as.factor(passive_user) + 
                 as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(church_attendance) +
                 as.factor(age_cat) +
                 as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest)
               ,  
               data = nonvoters_engaged, family = binomial
              
               )

summary(margins(model_4))
model_4a <- glm(over_reported_vote ~ as.factor(passive_user), data = nonvoters_engaged, family=binomial
                
                )

model_4_cts <- glm(over_reported_vote ~ as.factor(passive_user) + 
                 education +
                 
                 faminc_new +
                 #White +
                 Black +
                 other_non_White +
                 married +
                 church_attendance +
                 age_cat +
                 female +
                 ideological_strength +
                 political_interest 
                 #partisan_strength +
                 
               ,  
               data = nonvoters_cts_engaged, family = binomial
              
               )

stargazer(model_4, model_4a, model_4_cts, type="text")
```



```{r}
model_6 <- glm(over_reported_vote ~ as.factor(social_media_engagement) * as.factor(ideo5) +  #<--------------
                   as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(church_attendance) +
                 as.factor(age_cat) +
                 #as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest) 
              # + as.factor(partisan_strength)
                 ,
                 data = nonvoters_engaged, family = binomial
               )

model_6a <- glm(over_reported_vote ~ as.factor(social_media_engagement) * as.factor(ideo5) 
               ,  
                 data = nonvoters, family = binomial
               )

margins(model_6)

model_6_cts <- glm(over_reported_vote ~ social_media_engagement * ideo5 +
                      education +
                 faminc_new + 
                 #White + 
                 Black + 
                 other_non_White +
                 married +
                 church_attendance +
                 age_cat +
                 ideological_strength +
                 female +
                 political_interest# +
                # partisan_strength
                  ,  
                 data = nonvoters_cts_engaged, family = binomial)

summary(model_6)

summary(margins(model_6))

stargazer(model_6, model_6a, model_6_cts, type="text")
```

```{r}

exp(coef(model_6_u))
```


Output

```{r}

models <- list(model_1, model_2, model_4, model_4_robust, model_6)
models_cts <- list(model_1_cts, model_2_cts, model_4_cts, model_4_robust_cts, model_6_cts)
models_no_covariates <- list(model_1a, model_2a, model_3a, model_4a, model_5a, model_6a)
models_no_covariates_unweighted <- list(model_1a_u, model_2a_u, model_3a_u, model_4a_u, model_5a_u, model_6a_u)

stargazer(models, type="text")
stargazer(models_cts, type="text")
stargazer(models_no_covariates, type="text")
stargazer(models_no_covariates_unweighted, type="text")
```

Marginal Effects

```{r}

margins_models <- lapply(models, function(x) summary(margins(x)))
margins_no_covariates <- lapply(models_no_covariates, function(x) summary(margins(x)))
margins_cts <- lapply(models_cts, function(x) summary(margins(x)))
margins_no_covariates_unweighted <- lapply(models_no_covariates_unweighted, function(x) summary(margins(x)))

for (i in 1:length(margins_models)) {
  print(margins_models[[i]])
}

for (i in 1:length(margins_cts)) {
  print(margins_cts[[i]])
}

for (i in 1:length(margins_no_covariates)) {
  print(margins_no_covariates[[i]])
}

for (i in 1:length(margins_no_covariates_unweighted)) {
  print(margins_no_covariates_unweighted[[i]])
}

# compute_and_print_summaries <- function(model_list) {
#   # Compute margins and summaries
#   margins_summaries <- lapply(model_list, function(x) summary(margins(x)))
#   
#   # Print each summary
#   for (i in 1:length(margins_summaries)) {
#     print(margins_summaries[[i]])
#   }
# }
# 
# # Use this function on your lists of models
# compute_and_print_summaries(models)
# compute_and_print_summaries(models_unweighted)
# compute_and_print_summaries(models_no_covariates)
# compute_and_print_summaries(models_no_covariates_unweighted)

```
Active user robustness

```{r}
table(nonvoters_cts_engaged$faminc_new)
model_4_robust_cts <- glm(over_reported_vote ~ as.factor(user_engagement_category) #binary
                        +
                          education + # categories
                 faminc_new +#categories
                 Black +#binary
                 other_non_White + #binary
                 married + #binary
                 church_attendance +
                 age_cat +#categories
                 ideological_strength + #categories
                 female + #binary
                 political_interest 
                 #+ #categories
                 #partisan_strength #categories
                 ,
                 data = nonvoters_cts_engaged, family = binomial
                #, weights=commonweight
                )

#summary(margins(model_4_u_robust))

model_4a_robust <- glm(over_reported_vote ~ as.factor(user_engagement_category) #binary
                 ,
                 data = nonvoters_engaged, family = binomial
                #, weights=commonweight
                )

model_4_robust <- glm(over_reported_vote ~ as.factor(user_engagement_category) #binary
                      +  as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(church_attendance) +
                 as.factor(age_cat) +
                 as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest)  
                 ,
                 data = nonvoters_engaged, family = binomial
                
                )

levels(nonvoters_engaged$user_engagement_category)
str(model_4_robust)
summary(margins(model_4_robust))
                
str(nonvoters_engaged$user_engagement_category)
stargazer(model_4_robust, model_4a_robust, model_4_robust_cts, type="text")
```


```{r}
model_5_robust <- glm(over_reported_vote ~ as.factor(is_politically_engaged) * as.factor(ideo5) + 
                 as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(age_cat) +
                 as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest) + 
                 as.factor(partisan_strength),
                 data = nonvoters, family = binomial
               
               )
model_5a_robust <- glm(over_reported_vote ~ as.factor(is_politically_engaged) * as.factor(ideo5) , 
                 data = nonvoters, family = binomial
               
               )



summary(margins(model_5_robust))
stargazer(model_5_robust, model_5a_robust, type="text")
```

```{r}
model_robust <- glm(over_reported_vote ~
                 education +
                 
                 income + 
                 #White + 
                 Black + 
                 other_non_White +
                 church_attendance +
                   age_cat +
                 female +
                   ideological_strength +
                 political_interest 
                 ,
                 data = nonvoters, family = binomial
               
               )
model_robust2 <- glm(over_reported_vote2 ~
                 education +
                 
                 income + 
                 #White + 
                 Black + 
                 other_non_White +
                 church_attendance +
                   age_cat +
                 female +
                   ideological_strength +
                 political_interest 
                 ,
                 data = nonvoters, family = binomial
               
               )
table(nonvoters$over_reported_vote2)

model_robust_ols <- lm(did_you_vote ~
                 education +
                 
                 income + 
                 #White + 
                 Black + 
                 other_non_White +
                 church_attendance +
                   age_cat +
                 female +
                   ideological_strength +
                 political_interest 
                 ,
                 data = nonvoters, weights=commonpostweight
               
               )
model_robust2_ols <- lm(did_you_vote ~
                 education +
                 
                 income + 
                 #White + 
                 Black + 
                 other_non_White +
                 church_attendance +
                   age_cat +
                 female +
                   ideological_strength +
                 political_interest 
                 ,
                 data = nonvoters, weights = commonpostweight
               
               )

stargazer(model_robust, model_robust2, type="text")
stargazer(model_robust, model_robust2, model_robust_ols, model_robust2_ols, type="text")
summary(margins(model_robust2))
```
```{r}
model_6_ols <- lm(intend_to_vote ~ as.factor(social_media_engagement) * as.factor(ideo5) +  #<--------------
                   as.factor(education) + 
                 as.factor(income) +
                 Black +
                 other_non_White + 
                 married + 
                 as.factor(church_attendance) +
                 as.factor(age_cat) +
                 as.factor(ideological_strength) + 
                 female + 
                 as.factor(political_interest) 
              # + as.factor(partisan_strength)
                 ,
                 data = nonvoters_engaged, weights = commonweight
               )

model_6a_ols <- lm(intend_to_vote ~ as.factor(social_media_engagement) * as.factor(ideo5) 
               ,  
                 data = nonvoters, weights = commonweight
               )

margins(model_6)

model_6_cts_ols <- lm(intend_to_vote ~ social_media_engagement * ideo5 +
                      education +
                 faminc_new + 
                 #White + 
                 Black + 
                 other_non_White +
                 married +
                 church_attendance +
                 age_cat +
                 ideological_strength +
                 female +
                 political_interest# +
                # partisan_strength
                  ,  
                 data = nonvoters_cts_engaged, weights = commonweight)

summary(margins(model_6_cts_ols))
stargazer(model_6_ols, model_6a_ols, model_6_cts_ols, type="text")
```

